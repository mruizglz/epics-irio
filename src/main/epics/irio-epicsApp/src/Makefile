#+======================================================================
# $HeadURL: https://svnpub.iter.org/codac/iter/codac/dev/units/m-epics-irio/trunk/src/main/epics/irio-epicsApp/src/Makefile $
# $Id: Makefile 127616 2022-01-03 12:25:45Z kimh19 $
#
# Project       : CODAC Core System
#
# Description   : Makefile
#
# Author(s)     : This file was generated by CODAC development toolkit
#
# Copyright (c) : 2010-2022 ITER Organization,
#                 CS 90 046
#                 13067 St. Paul-lez-Durance Cedex
#                 France
#
# This file is part of ITER CODAC software.
# For the terms and conditions of redistribution or use of this software
# refer to the file ITER-LICENSE.TXT located in the top level directory
# of the distribution package.
#
#-======================================================================
TOP=../..
HOST_OPT = NO
include $(TOP)/configure/CONFIG
#----------------------------------------
#  ADD MACRO DEFINITIONS AFTER THIS LINE

ifndef CODAC_ROOT
 IRIOCORE_DIR = $(realpath $(TOP)/../iriocore )
endif





#=============================
# Build the IOC support library

LIBRARY += irio-epics

# Add source file for module
LIB_SRCS += irioAsyn.c

# irioAsyn.dbd will be created and installed
DBD += irioAsyn.dbd

# irioAsyn.dbd will be made up from base.dbd and module dbds listed below:
irioAsyn_DBD += regIrioAsyn.dbd

#=============================
# Add support for the following uncommented modules:

# # ASYN
irioAsyn_LIBS += asyn
#=============================
USR_CPPFLAGS += -fPIC
USR_SYS_LIBS += irioCore
##Conditional compilation of IRIOCore
ifdef CODAC_ROOT
	USR_CPPFLAGS += -I$(CODAC_ROOT)/include/irioCore
	USR_LDFLAGS += -L$(CODAC_ROOT)/lib -Wl,-rpath=$(CODAC_ROOT)/lib
else
	USR_CPPFLAGS += -I$(IRIOCORE_DIR)/target/main/c/include
	USR_LDFLAGS += -L$(IRIOCORE_DIR)/target/lib -Wl,-rpath=$(IRIOCORE_DIR)/target/lib 
endif

#=============================
# Finally link to the EPICS Base libraries
irioAsyn_LIBS += $(EPICS_BASE_IOC_LIBS)

#=============================

include $(TOP)/configure/RULES
#----------------------------------------
#  ADD RULES AFTER THIS LINE

